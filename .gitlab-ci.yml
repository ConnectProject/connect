image: node:12-alpine

cache:
  key: ci-cache-$CI_COMMIT_REF_SLUG
  paths:
    - node_modules/

stages:
  - build
  - test

####
####
#### TEMPLATES
####
####

.base_job:
  tags:
    - k8s

####
####
#### BUILD STAGE
####
####

build:
  extends: .base_job
  stage: build
  script:
    - yarn install

####
####
#### LINT STAGE
####
####

lint:
  extends: .base_job
  stage: test
  script:
    - yarn install
    - yarn tslint.check
    - yarn prettier.check
  cache:
    policy: pull

test:
  extends: .base_job
  stage: test
  script:
    - yarn install
    - yarn test
  cache:
    policy: pull
